"use strict";(self.webpackChunkmobilecourse=self.webpackChunkmobilecourse||[]).push([[5204],{3825:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>d});var s=n(4848),i=n(8453);const o={title:"SQLite",sidebar_position:2},a=void 0,r={id:"DataPersistence/sqlite",title:"SQLite",description:"SQLite  (https://www.sqlite.org/) is light-weight SQL database and it is built into both Android and iOS devices.expo-sqlite is the library that gives an access to SQLite database on the device.",source:"@site/docs/DataPersistence/sqlite.md",sourceDirName:"DataPersistence",slug:"/DataPersistence/sqlite",permalink:"/mobilecourse/docs/DataPersistence/sqlite",draft:!1,unlisted:!1,editUrl:"https://github.com/haagahelia/mobileprogramming.git/docs/DataPersistence/sqlite.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"SQLite",sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Async Storage",permalink:"/mobilecourse/docs/DataPersistence/asyncstorage"},next:{title:"Firebase",permalink:"/mobilecourse/docs/DataPersistence/firebase"}},c={},d=[{value:"Using <code>SQLiteProvider</code> component",id:"using-sqliteprovider-component",level:3}];function l(e){const t={a:"a",admonition:"admonition",code:"code",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"SQLite"}),"  (",(0,s.jsx)(t.a,{href:"https://www.sqlite.org/",children:"https://www.sqlite.org/"}),") is light-weight SQL database and it is built into both Android and iOS devices.",(0,s.jsx)(t.code,{children:"expo-sqlite"})," is the library that gives an access to SQLite database on the device."]}),"\n",(0,s.jsx)(t.p,{children:"Installation:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"npx expo install expo-sqlite \n"})}),"\n",(0,s.jsx)(t.p,{children:"Example: Courselist app where user types course title and credits. The course is saved to a database when save button is pressed. All courses are shown in the flatlist component."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{src:n(9167).A+"",width:"347",height:"617"})}),"\n",(0,s.jsxs)(t.p,{children:["First, import the SQLite from ",(0,s.jsx)(t.code,{children:"expo-sqlite"})," to your Component"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:"import * as SQLite from 'expo-sqlite';\n"})}),"\n",(0,s.jsxs)(t.p,{children:["States are needed for title and credit input fields and all courses that are shown in the ",(0,s.jsx)(t.code,{children:"FlatList"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:" const [credit, setCredit] = useState('');\n const [title, setTitle] = useState('');\n const [courses, setCourses] = useState([]);\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Next, we intialize the database connection using the ",(0,s.jsx)(t.code,{children:"openDatabaseSync"})," function.  The function takes a single argument, which is the name of the SQLite database file to open or create. If the specified database file exists, it will be opened. If it doesn't exist, a new database file with that name will be created."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:"const db = SQLite.openDatabaseSync('coursedb');\n"})}),"\n",(0,s.jsxs)(t.admonition,{type:"note",children:[(0,s.jsx)(t.p,{children:"The library has synchronous and asynchronous versions of functions. Running heavy tasks with synchronous functions can block the JavaScript thread and affect performance."}),(0,s.jsx)(t.p,{children:"We will be using mostly asynchronous functions in this example. For simplicity, we make here a synchronous call to open the database."})]}),"\n",(0,s.jsx)(t.p,{children:"Opening the database returns database object. Using the methods of the database object we can make SQL queries."}),"\n",(0,s.jsxs)(t.p,{children:["First we need create the database schema in case this is the first invocation of the application. We write a function to create the schema and use the ",(0,s.jsx)(t.code,{children:"execAsync"})," method to make the SQL query."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:"const initialize = async () => {\n  try {\n    await db.execAsync(`\n      CREATE TABLE IF NOT EXISTS course (id INTEGER PRIMARY KEY NOT NULL, credits INT, title TEXT);\n    `);\n    // Todo: update the course list\n  } catch (error) {\n    console.error('Could not open database', error);\n  }\n}\n"})}),"\n",(0,s.jsx)(t.admonition,{type:"note",children:(0,s.jsxs)(t.p,{children:["Because we use the ",(0,s.jsx)(t.code,{children:"async"}),"-",(0,s.jsx)(t.code,{children:"await"}),"syntax to handle the asynhronous calls we need to use exception handling to handle possible database errors."]})}),"\n",(0,s.jsx)(t.p,{children:"The application logic would require that we retrieve the course list from the database and render it for the user at startup. The function to do that will be implemented later."}),"\n",(0,s.jsxs)(t.p,{children:["We make only one query but multiple queries could be done in one ",(0,s.jsx)(t.code,{children:"execAsync"})," call. For that reason we need to terminate the query with a semicolon (",(0,s.jsx)(t.code,{children:";"}),")."]}),"\n",(0,s.jsxs)(t.p,{children:["The database initialization function is called using the ",(0,s.jsx)(t.code,{children:"useEffect"})," hook."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:"useEffect(() => { initialize() }, []);\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Next we need a way to create content in the database. We add two input fields (title and credits) and a button to save the new item to the database when pressed. The button will call function ",(0,s.jsx)(t.code,{children:"saveItem"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-jsx",children:"<TextInput \n  placeholder='Title' \n  onChangeText={title => setTitle(title)}\n  value={title}/> \n<TextInput \n  placeholder='Credits' \n  keyboardType='numeric' \n  onChangeText={credit => setCredit(credit)}\n  value={credit}/> \n<Button onPress={saveItem} title=\"Save\" />\n"})}),"\n",(0,s.jsxs)(t.p,{children:["We write function ",(0,s.jsx)(t.code,{children:"saveItem"})," to make the ",(0,s.jsx)(t.code,{children:"INSERT"})," query to add rows into the database. We use ",(0,s.jsx)(t.code,{children:"runAsync"})," method to make the query."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:"const saveItem = async () => {\n  try {\n    await db.runAsync('INSERT INTO course VALUES (?, ?, ?)', null, credit, title);\n    // Todo: update the course list\n  } catch (error) {\n    console.error('Could not add item', error);\n  }\n};\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Finally we can implement the function ",(0,s.jsx)(t.code,{children:"updateList"})," to get the list of courses from the database. The function makes a ",(0,s.jsx)(t.code,{children:"SELECT"})," query using method ",(0,s.jsx)(t.code,{children:"getAllAsync"})," to fetch all rows from the course table and updates the data to state variable ",(0,s.jsx)(t.code,{children:"courses"}),". The state update launches a re-render."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:"  const updateList = async () => {\n    try {\n      const list = await db.getAllAsync('SELECT * from course');\n      setCourses(list);\n    } catch (error) {\n      console.error('Could not get items', error);\n    }\n  }\n"})}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"updateList"})," function should be executed at first render and after any successful change in the database. Add the ",(0,s.jsx)(t.code,{children:"updateList"})," call to the placeholders in the functions defined earlier."]}),"\n",(0,s.jsxs)(t.p,{children:["In the ",(0,s.jsx)(t.code,{children:"FlatList"})," component, we show the title and credits of the courses. For deleting courses we add a ",(0,s.jsx)(t.code,{children:"Text"})," component on each row and attach an ",(0,s.jsx)(t.code,{children:"onPress"})," action to that calls function ",(0,s.jsx)(t.code,{children:"deleteItem"})," to each component. The unique id of the item is passed to the delete function."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-jsx",children:"<FlatList\n  keyExtractor={item => item.id.toString()}\n  renderItem={({ item }) =>\n    <View style={styles.itemcontainer}>\n      <Text>{item.title}</Text>\n      <Text>{item.credits} </Text>\n      <Text style={{ color: '#0000ff' }} onPress={() => deleteItem(item.id)}>done</Text>\n    </View>}\n  data={courses}\n/>\n"})}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"deleteItem"})," function deletes item from the course table and updates the course list after the deletion."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:"const deleteItem = async (id) => {\n    console.log('deleteItem')\n    try {\n      await db.runAsync('DELETE FROM course WHERE id=?', id);\n      await updateList();\n    }\n    catch (error) {\n      console.error('Could not delete item', error);\n    }\n  }\n"})}),"\n",(0,s.jsxs)(t.h3,{id:"using-sqliteprovider-component",children:["Using ",(0,s.jsx)(t.code,{children:"SQLiteProvider"})," component"]}),"\n",(0,s.jsxs)(t.p,{children:["If there are sevaral components in the application, ",(0,s.jsx)(t.code,{children:"SQLiteProvider"})," component can be used to share the database across the components. All components rendered within a ",(0,s.jsx)(t.code,{children:"SQLiteProvider"})," can access the database using the ",(0,s.jsx)(t.code,{children:"useSQLiteContext"})," hook."]}),"\n",(0,s.jsxs)(t.p,{children:["Let us refactor the application into two components: ",(0,s.jsx)(t.code,{children:"App"})," provides the database context to all component within the app and ",(0,s.jsx)(t.code,{children:"Courselist"})," renders the course list application."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",metastring:'title="App.jsx"',children:"import { SQLiteProvider } from 'expo-sqlite';\nimport Courselist from './Courselist';\n\nexport default function App() {\n\n  const initialize = async (db) => {\n    db.execAsync(`\n      CREATE TABLE IF NOT EXISTS course (id INTEGER PRIMARY KEY NOT NULL, credits INT, title TEXT);\n    `);\n  };\n\n  return (\n    <SQLiteProvider\n      databaseName='coursedb.db'\n      onInit={initialize}\n      onError={error => console.error('Could not open database', error)}\n    >\n      <Courselist />\n    </SQLiteProvider>\n  );\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"SQLIteProvider"})," properties:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"databaseName"})," defines the database file name. ",(0,s.jsx)(t.code,{children:"SQLiteProvider"})," takes care of opening the database."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"onInit "})," defines an initialization handler that is run before rendering the children of the component. We use it to create the database schema."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"onError"})," handler is called if an error occurs."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"Courselist"})," component gets the database object by calling the ",(0,s.jsx)(t.code,{children:"useSQLiteContext"})," hook."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",metastring:'title="Courselist.jsx"',children:"// highlight-next-line\nimport { useSQLiteContext } from 'expo-sqlite';\n// ...\n\nexport default function Courselist() {\n  const [credit, setCredit] = useState('');\n  const [title, setTitle] = useState('');\n  const [courses, setCourses] = useState([]);\n\n  // highlight-next-line\n  const db = useSQLiteContext();\n\n  const saveItem = async () => {\n    try {\n      await db.runAsync('INSERT INTO course VALUES (?, ?, ?)', null, credit, title);\n      await updateList();\n    } catch (error) {\n      console.error('Could not add item', error);\n    }\n  };\n\n  // ...\n\n  // highlight-next-line\n  useEffect(() => { updateList() }, []);\n\n  // ...\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Because the database initialization is done in an other component, we need to launch the initial list update using the ",(0,s.jsx)(t.code,{children:"useEffect"})," hook."]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},9167:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/courselist-c78f88169b1818b2ed4e50cb338b0375.png"},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>r});var s=n(6540);const i={},o=s.createContext(i);function a(e){const t=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(o.Provider,{value:t},e.children)}}}]);