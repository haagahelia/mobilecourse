"use strict";(self.webpackChunkmobilecourse=self.webpackChunkmobilecourse||[]).push([[8327],{404:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>c,toc:()=>d});var n=s(5893),i=s(1151);const a={title:"SQLite",sidebar_position:2},r=void 0,c={id:"DataPersistence/sqlite",title:"SQLite",description:"SQLite  (https://www.sqlite.org/) is light-weight SQL database and it is built into both Android and iOS devices.expo-sqlite is the library that gives an access to SQLite database.",source:"@site/docs/DataPersistence/sqlite.md",sourceDirName:"DataPersistence",slug:"/DataPersistence/sqlite",permalink:"/mobilecourse/docs/DataPersistence/sqlite",draft:!1,unlisted:!1,editUrl:"https://github.com/haagahelia/mobileprogramming.git/docs/DataPersistence/sqlite.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"SQLite",sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Async Storage",permalink:"/mobilecourse/docs/DataPersistence/asyncstorage"},next:{title:"Firebase",permalink:"/mobilecourse/docs/DataPersistence/firebase"}},o={},d=[];function l(e){const t={a:"a",code:"code",img:"img",p:"p",pre:"pre",strong:"strong",...(0,i.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"SQLite"}),"  (",(0,n.jsx)(t.a,{href:"https://www.sqlite.org/",children:"https://www.sqlite.org/"}),") is light-weight SQL database and it is built into both Android and iOS devices.",(0,n.jsx)(t.code,{children:"expo-sqlite"})," is the library that gives an access to SQLite database."]}),"\n",(0,n.jsx)(t.p,{children:"Installation:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"npx expo install expo-sqlite \n"})}),"\n",(0,n.jsx)(t.p,{children:"Example: Courselist app where user types course title and credits. The course is saved to a database when save button is pressed. All courses are shown in the flatlist component."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:s(5057).Z+"",width:"347",height:"617"})}),"\n",(0,n.jsxs)(t.p,{children:["First, import the SQLite from ",(0,n.jsx)(t.code,{children:"expo-sqlite"})," to your Component"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:"import * as SQLite from 'expo-sqlite';\n"})}),"\n",(0,n.jsxs)(t.p,{children:["States are needed for title and credit input fields and all courses that are shown in the ",(0,n.jsx)(t.code,{children:"FlatList"}),"."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:" const [credit, setCredit] = useState('');\n const [title, setTitle] = useState('');\n const [courses, setCourses] = useState([]);\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Next, we intialize the database connection using the ",(0,n.jsx)(t.code,{children:"openDatabase"})," function.  The function takes a single argument, which is the name of the SQLite database file to open or create. If the specified database file exists, it will be opened. If it doesn't exist, a new database file with that name will be created."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:"const db = SQLite.openDatabase('coursedb.db');\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Opening a database returns database object.  The object has method ",(0,n.jsx)(t.code,{children:"transaction"})," which can be used for database operations. Method has three parameters: The first is one is used to execute sql statement. The second one is an optional error callback function that is called if an error occurs during the transaction. The third one is executed when transaction is completed successfully."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:"db.transaction(callback, error, success)\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Database is created in the ",(0,n.jsx)(t.code,{children:"useEffect"})," hook by using transaction's ",(0,n.jsx)(t.code,{children:"executeSql"})," method."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:"  useEffect(() => {\n    db.transaction(tx => {\n      tx.executeSql('create table if not exists course (id integer primary key not null, credits int, title text);');\n    }, () => console.error(\"Error when creating DB\"), updateList);  \n  }, []);\n"})}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"updateList"})," function fetch all courses from the database and updates the ",(0,n.jsx)(t.code,{children:"FlatList"})," (code is shown later)."]}),"\n",(0,n.jsxs)(t.p,{children:["In the ",(0,n.jsx)(t.code,{children:"return"})," statement we rended two input fields (title and credits) and button which saves item to database when it is pressed. The button will execute ",(0,n.jsx)(t.code,{children:"saveItem"})," function which handles ",(0,n.jsx)(t.code,{children:"insert"})," operation to database."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-jsx",children:"<TextInput \n  placeholder='Title' \n  onChangeText={title => setTitle(title)}\n  value={title}/> \n<TextInput \n  placeholder='Credits' \n  keyboardType='numeric' \n  onChangeText={credit => setCredit(credit)}\n  value={credit}/> \n<Button onPress={saveItem} title=\"Save\" />\n"})}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"saveItem"})," function uses ",(0,n.jsx)(t.code,{children:"executeSql"})," method to insert new item in the course table. The ",(0,n.jsx)(t.code,{children:"updateList"})," function is executed after successful insert. Query argument array is the second parameter in executeSql method (substitutes ?-marks in the SQL statement)"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:"const saveItem = () => {\n  db.transaction(tx => {\n    tx.executeSql('insert into course (credits, title) values (?, ?);',\n\t  [parseInt(credit), title]);\n    }, null, updateList)\n}\n"})}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"updateList"})," function fetch all items from the course table and save data to ",(0,n.jsx)(t.code,{children:"courses"})," state (-> re-render).  The third parameter of the ",(0,n.jsx)(t.code,{children:"executeSql"})," function is success function which takes resultset object as a second argument. The Resultset object contains ",(0,n.jsx)(t.code,{children:"rows._array"})," which is the array of rows returned by query."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:"const updateList = () => {\n  db.transaction(tx => {\n    tx.executeSql('select * from course;', [], (_, { rows }) =>\n      setCourses(rows._array)\n    ); \n  }, null, null);\n}\n"})}),"\n",(0,n.jsxs)(t.p,{children:["In the ",(0,n.jsx)(t.code,{children:"FlatList"})," component, we show title and credits of the courses. Each rows contains also ",(0,n.jsx)(t.code,{children:"Text"})," component that executes ",(0,n.jsx)(t.code,{children:"deleteItem"})," function when it is pressed. The unique id of the item is passed to the delete function."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-jsx",children:"<FlatList \n  style={{marginLeft : \"5%\"}}\n  keyExtractor={item => item.id.toString()} \n  renderItem={({item}) => \n    <View style={styles.listcontainer}>\n      <Text>{item.title},{item.credits} </Text>\n      <Text style={{color: '#0000ff'}} onPress={() => deleteItem(item.id)}>done</Text>\n    </View>}     \t\n  data={courses} \n/> \n"})}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"deleteItem"})," function deletes item from the course table and updates flatlist after the deletion."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:"const deleteItem = (id) => {\n  db.transaction(\n  tx => tx.executeSql('delete from course where id = ?;', [id]);}, null, updateList) \n}\n"})})]})}function h(e={}){const{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},5057:(e,t,s)=>{s.d(t,{Z:()=>n});const n=s.p+"assets/images/courselist-c78f88169b1818b2ed4e50cb338b0375.png"},1151:(e,t,s)=>{s.d(t,{Z:()=>c,a:()=>r});var n=s(7294);const i={},a=n.createContext(i);function r(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);